<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Devotionals | Madison Christian Fellowship</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <main class="devo-page">
    <div class="devo-inner">
      <div class="devo-head">
        <h1 class="devo-title">Devotionals</h1>
        <a class="devo-all" href="index.html">Back to Home</a>
      </div>

      <div id="devoList" class="devo-list">
        <p class="devo-loading">Loading devotionals…</p>
      </div>
    </div>
  </main>

  <script>
    async function loadAllDevotionals() {
      const list = document.getElementById("devoList");
      try {
        const res = await fetch("data/devotionals.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Could not load devotionals.json");
        const items = await res.json();

        if (!Array.isArray(items) || items.length === 0) {
          list.innerHTML = `<p class="devo-loading">No devotionals yet.</p>`;
          return;
        }

        items.sort((a, b) => (b.date || "").localeCompare(a.date || ""));
        const safe = (v) => (v ?? "").toString();

        list.innerHTML = items.map(d => {
          const anchor = encodeURIComponent(safe(d.id || d.date));
          const paragraphs = safe(d.content).split("\\n\\n").map(p => `<p class="devo-text">${p}</p>`).join("");
          const prayer = safe(d.prayer) ? `<p class="devo-text"><strong>Prayer:</strong> ${safe(d.prayer)}</p>` : "";

          return `
            <article id="${anchor}" class="devo-card" style="margin-bottom:1.2rem;">
              <div class="devo-meta">${safe(d.date)} • ${safe(d.scripture)}</div>
              <h3 class="devo-h3">${safe(d.title)}</h3>
              ${paragraphs}
              ${prayer}
            </article>
          `;
        }).join("");
      } catch (err) {
        list.innerHTML = `<p class="devo-loading">Unable to load devotionals right now.</p>`;
        console.error(err);
      }
    }

    loadAllDevotionals();
  </script>

</body>
</html>
