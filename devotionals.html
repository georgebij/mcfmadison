<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Devotionals | Madison Christian Fellowship</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="devotional-header">
    <a href="index.html" class="back-home">
      ← Back to Madison Christian Fellowship
    </a>
  </header>

  <main class="devo-page">
    <div class="devo-inner">
      <div class="devo-head">
        <h1 class="devo-title">Daily Devotional</h1>
        <p class="devo-subtitle">
          Read • Reflect • Pray<br>
          A quiet moment with God — from Madison Christian Fellowship
        </p>
      </div>

      <div id="devoList" class="devo-list">
        <p class="devo-loading">Loading devotionals…</p>
      </div>
    </div>
  </main>

  <script>
    async function loadAllDevotionals() {
  const list = document.getElementById("devoList");

  try {
    const res = await fetch("./data/devotionals.json", { cache: "no-store" });
    if (!res.ok) throw new Error("Could not load devotionals.json");

    const items = await res.json();

    if (!Array.isArray(items) || items.length === 0) {
      list.innerHTML = `<p class="devo-loading">No devotionals yet.</p>`;
      return;
    }

    items.sort((a, b) => (b.date || "").localeCompare(a.date || ""));

    const today = items[0];
    const rest = items.slice(1);

    list.innerHTML = `
      <h2 class="today-label">Today’s Devotional</h2>
      ${renderDevotional(today)}
      <h2 class="today-label">Previous Devotionals</h2>
      ${rest.map(d => renderDevotional(d)).join("")}
    `;
  } catch (err) {
    list.innerHTML = `<p class="devo-loading">Unable to load devotionals.</p>`;
    console.error(err);
  }
}

    function renderDevotional(d) {
      const safe = (v) => (v ?? "").toString();
      const anchor = encodeURIComponent(safe(d.id || d.date));
      const paragraphs = safe(d.content)
        .split("\\n\\n")
        .map(p => `<p class="devo-text">${p}</p>`)
        .join("");
      const prayer = safe(d.prayer)
        ? `<p class="devo-text"><strong>Prayer:</strong> ${safe(d.prayer)}</p>`
        : "";

      return `
        <article id="${anchor}" class="devo-card" style="margin-bottom:1.2rem;">
          <div class="devo-meta">${safe(d.date)} • ${safe(d.scripture)}</div>
          <h3 class="devo-h3">${safe(d.title)}</h3>
          ${paragraphs}
          ${prayer}
        </article>
      `;
    }

    loadAllDevotionals();
  </script>

</body>
</html>
