<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PKL9B1PZ48"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PKL9B1PZ48', {
      anonymize_ip: true
    });
  </script>

  <title>Devotionals | Madison Christian Fellowship</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="devotional-header">
    <a href="index.html"
      class="back-home"
      style="color:#ffffff; text-decoration:none;">
      ‚Üê Back to Madison Christian Fellowship
    </a>
  </header>

  <main class="devo-page">
    <div class="devo-inner">
      <div class="devo-head">
        <h1 class="devo-title">Daily Devotional</h1>
        <p class="devo-subtitle">
          Read ‚Ä¢ Reflect ‚Ä¢ Pray<br>
          A quiet moment with God ‚Äî from Madison Christian Fellowship
        </p>
      </div>
    <!--  CONTINUOUS AUDIO PLAYER  -->
    <section id="continuous-audio" class="continuous-audio">
      <p class="audio-label">üéß Continuous Listening All Devotionals</p>
      <audio id="globalAudio" controls preload="none"></audio>
    </section>
    <!--  END CONTINUOUS AUDIO PLAYER  -->
      <div id="devoList" class="devo-list">
        <p class="devo-loading">Loading devotionals‚Ä¶</p>
      </div>
    </div>
  </main>

<script>
  /* 1Ô∏è‚É£ helper functions */
  function renderDevotional(d) {
    const safe = (v) => (v ?? "").toString();
    const anchor = encodeURIComponent(safe(d.id || d.date));

    const paragraphs = safe(d.content)
      .split("\n\n")
      .map(p => `<p class="devo-text">${p}</p>`)
      .join("");

    const prayer = safe(d.prayer)
      ? `<p class="devo-text"><strong>Prayer:</strong> ${safe(d.prayer)}</p>`
      : "";

    const audioBlock = d.audio
      ? `
        <section class="devotion-audio">
          <p class="audio-label">üîä Listen to this devotion audio</p>
          <audio controls preload="none">
            <source src="${safe(d.audio)}" type="audio/mp4">
            <source src="${safe(d.audio)}" type="audio/mpeg">
            Your browser does not support audio playback.
          </audio>
        </section>
      `
      : "";

    return `
      <article id="${anchor}" class="devo-card" style="margin-bottom:1.2rem;">

        <!-- Date -->
        <div class="devo-meta">${safe(d.date)}</div>

        <!-- Title -->
        <h3 class="devo-h3">${safe(d.title)}</h3>

        <!-- Scripture (separate line, below title) -->
        <div class="devo-scripture">${safe(d.scripture)}</div>

        <!-- Content -->
        ${paragraphs}

        <!-- Prayer -->
        ${prayer}

        <!-- Individual devotional audio -->
        ${audioBlock}

      </article>
    `;
  }

  /* ===== CONTINUOUS AUDIO PLAYER ===== */
  let audioList = [];
  let currentTrack = 0;

  function initContinuousAudio(devotionals) {
    audioList = devotionals
      .filter(d => d.audio)
      .map(d => d.audio);

    if (audioList.length === 0) return;

    const player = document.getElementById("globalAudio");
    if (!player) return;

    currentTrack = 0;
    player.src = audioList[currentTrack];

    player.addEventListener("ended", () => {
      currentTrack++;
      if (currentTrack < audioList.length) {
        player.src = audioList[currentTrack];
        player.play();
      }
    });
  }
  /* ===== END CONTINUOUS AUDIO PLAYER ===== */

  /*  loader function */
  async function loadAllDevotionals() {
    const list = document.getElementById("devoList");

    try {
      const res = await fetch("./data/devotionals.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load devotionals.json");

      const items = await res.json();

      if (!Array.isArray(items) || items.length === 0) {
        list.innerHTML = `<p class="devo-loading">No devotionals yet.</p>`;
        return;
      }

      items.sort((a, b) => (b.date || "").localeCompare(a.date || ""));

      const today = items[0];
      const rest = items.slice(1);

      list.innerHTML = `
        <h2 class="today-label">Today‚Äôs Devotional</h2>
        ${renderDevotional(today)}
        <h2 class="today-label">Previous Devotionals</h2>
        ${rest.map(d => renderDevotional(d)).join("")}
      `;
      // ‚úÖ initialize continuous audio ONCE, with full list
      initContinuousAudio(items);
    } catch (err) {
      list.innerHTML = `<p class="devo-loading">Unable to load devotionals.</p>`;
      console.error(err);
    } 
  }

loadAllDevotionals();
 
</script>
    <p style="font-size:0.85rem; color:#94a3b8; text-align:center; margin-top:40px;">
      <a href="about-devotionals.html">About these devotionals</a>
    </p>

</body>
</html>
